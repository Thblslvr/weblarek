# Проектная работа "Веб-ларек"

**Стек:** HTML, SCSS, TS, Vite

**Структура проекта:**
- `src/` — исходные файлы проекта
- `src/components/` — папка с JS компонентами
- `src/components/base/` — папка с базовым кодом

**Важные файлы:**
- `index.html` — HTML-файл главной страницы
- `src/types/index.ts` — файл с типами
- `src/main.ts` — точка входа приложения
- `src/scss/styles.scss` — корневой файл стилей
- `src/utils/constants.ts` — файл с константами
- `src/utils/utils.ts` — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды:

```bash
npm install
npm run start
```

или

```bash
yarn
yarn start
```

## Сборка

```bash
npm run build
```

или

```bash
yarn build
```

# Интернет-магазин «Web-Larёk»

«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

- **Model** - слой данных, отвечает за хранение и изменение данных
- **View** - слой представления, отвечает за отображение данных на странице
- **Presenter** - презентер содержит основную логику приложения и отвечает за связь представления и данных

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component
Является базовым классом для всех компонентов интерфейса. Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

**Конструктор:**
```typescript
constructor(container: HTMLElement)
```
Принимает ссылку на DOM элемент за отображение, которого он отвечает.

**Поля класса:**
- `container: HTMLElement` - поле для хранения корневого DOM элемента компонента

**Методы класса:**
- `render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент
- `setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`

#### Класс Api
Содержит в себе базовую логику отправки запросов.

**Конструктор:**
```typescript
constructor(baseUrl: string, options: RequestInit = {})
```
В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

**Поля класса:**
- `baseUrl: string` - базовый адрес сервера
- `options: RequestInit` - объект с заголовками, которые будут использован для запросов

**Методы:**
- `get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода
- `handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных

#### Класс EventEmitter
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

**Конструктор класса** не принимает параметров.

**Поля класса:**
- `_events: Map<string | RegExp, Set<Function>>)` - хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события

**Методы класса:**
- `on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик
- `emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика
- `trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра

### Типы данных

В файле `src/types/index.ts` определены следующие типы данных:

**Интерфейс для товара (IProduct)**
```typescript
interface IProduct {
    id: string;
    title: string;
    price: number | null;
    category: string;
    image: string;
    description?: string;
}
```

**Интерфейс для данных покупателя (IOrderForm)**
```typescript
interface IOrderForm {
    payment: 'card' | 'cash';
    address: string;
    email: string;
    phone: string;
}
```

**Тип для объекта заказа (IOrder)**
```typescript
interface IOrder extends IOrderForm {
    items: string[];
    total: number;
}
```

**Интерфейс результата заказа (IOrderResult)**
```typescript
interface IOrderResult {
    id: string;
    total: number;
}
```

### Классы слоя «Модели»

#### Класс Products (модель каталога товаров)
**Расположение:** `src/components/Models/Products.ts`

**Методы:**
- `setItems(items: IProduct[])` - устанавливает массив товаров
- `getItems(): IProduct[]` - возвращает все товары
- `getItem(id: string): IProduct | undefined` - возвращает товар по ID

#### Класс Basket (модель корзины покупок)
**Расположение:** `src/components/Models/Basket.ts`

**Методы:**
- `addItem(item: IProduct)` - добавляет товар в корзину
- `removeItem(id: string)` - удаляет товар из корзины по ID
- `getItems(): IProduct[]` - возвращает все товары в корзине
- `getTotal(): number` - вычисляет общую стоимость товаров в корзине
- `clearBasket()` - очищает корзину

#### Класс Order (модель данных заказа)
**Расположение:** `src/components/Models/Order.ts`

**Методы:**
- `setOrderForm(form: Partial<IOrderForm>)` - устанавливает данные формы заказа
- `setItems(items: string[])` - устанавливает список ID товаров в заказе
- `setTotal(total: number)` - устанавливает общую сумму заказа
- `clearOrder()` - очищает данные заказа

### Классы слоя «Представления»

#### Класс Page
**Расположение:** `src/components/Views/Page.ts`

Отвечает за управление основными элементами страницы.

**Методы:**
- `set basketCounter(value: number)` - обновляет счетчик корзины
- `set locked(value: boolean)` - блокирует/разблокирует прокрутку страницы
- `clearGallery()` - очищает галерею товаров
- `renderGallery(items: HTMLElement[])` - отображает элементы в галерее
- `setBasketClickHandler(handler: () => void)` - устанавливает обработчик клика по корзине

#### Класс Catalog
**Расположение:** `src/components/Views/Catalog.ts`

Отвечает за отображение каталога товаров.

**Методы:**
- `set items(value: IProduct[])` - устанавливает массив товаров для отображения
- `onCardClick` - обработчик клика по карточке товара

#### Класс Card
**Расположение:** `src/components/Views/Card.ts`

Отвечает за отображение карточки товара.

**Свойства:**
- `title` - устанавливает заголовок товара
- `price` - устанавливает цену товара
- `category` - устанавливает категорию товара
- `image` - устанавливает изображение товара
- `description` - устанавливает описание товара
- `buttonText` - устанавливает текст кнопки
- `buttonDisabled` - управляет состоянием кнопки

**События:**
- `onClick` - обработчик клика по карточке
- `onButtonClick` - обработчик клика по кнопке

#### Класс Basket
**Расположение:** `src/components/Views/Basket.ts`

Отвечает за отображение корзины товаров.

**Методы:**
- `set items(value: IProduct[])` - устанавливает товары в корзине
- `set total(value: number)` - устанавливает общую сумму
- `set buttonDisabled(value: boolean)` - управляет состоянием кнопки оформления заказа

**События:**
- `onRemoveItem` - обработчик удаления товара из корзины
- `onCheckout` - обработчик оформления заказа

#### Класс Modal
**Расположение:** `src/components/Views/Modal.ts`

Управляет модальными окнами.

**Методы:**
- `open()` - открывает модальное окно
- `close()` - закрывает модальное окно
- `set content(value: HTMLElement)` - устанавливает содержимое модального окна

#### Базовый класс Form
**Расположение:** `src/components/Views/Form.ts`

Базовый класс для форм.

**Методы:**
- `set submitButtonDisabled(value: boolean)` - управляет состоянием кнопки отправки
- `set errors(value: string)` - устанавливает текст ошибки

#### Класс OrderForm
**Расположение:** `src/components/Views/OrderForm.ts`

Форма оформления заказа. Наследуется от Form.

**Методы:**
- `validateForm()` - валидирует форму
- `setPaymentMethod(method: 'card' | 'cash')` - устанавливает способ оплаты

**События:**
- `onSubmit` - обработчик отправки формы

#### Класс ContactsForm
**Расположение:** `src/components/Views/ContactsForm.ts`

Форма контактных данных. Наследуется от Form.

**Методы:**
- `validateForm()` - валидирует форму

**События:**
- `onSubmit` - обработчик отправки формы

#### Класс SuccessMessage
**Расположение:** `src/components/Views/SuccessMessage.ts`

Сообщение об успешном оформлении заказа.

**Методы:**
- `set total(value: number)` - устанавливает сумму заказа
- `set onClose(handler: () => void)` - устанавливает обработчик закрытия

#### Класс BasketCounter
**Расположение:** `src/components/Views/BasketCounter.ts`

Счетчик товаров в корзине.

**Методы:**
- `set count(value: number)` - устанавливает количество товаров

### Класс коммуникационного слоя

#### WebLarekApi
**Расположение:** `src/components/Api/WebLarekApi.ts`

Наследует базовый класс Api и реализует специфичные для приложения методы:

**Методы:**
- `getProducts(): Promise<IProduct[]>` - получает список товаров с сервера
- `createOrder(order: IOrder): Promise<IOrderResult>` - отправляет заказ на сервер и возвращает результат

## Реализация в основном скрипте

В файле `src/main.ts` реализовано:

1. Создание экземпляров всех необходимых классов:

```typescript
const productsModel = new Products();
const basketModel = new BasketModel();
const orderModel = new Order();
const api = new WebLarekApi(API_URL);
```

2. Тестирование методов моделей данных:
- Запрос к серверу за массивом товаров с использованием `api.getProducts()`
- Сохранение полученных данных в модели с помощью `productsModel.setItems(products)`
- Вывод массива товаров в консоль для проверки с использованием `productsModel.getItems()`
- Тестирование работы корзины: добавление, удаление товаров, расчет общей суммы
- Тестирование оформления заказа: установка данных формы, отправка на сервер

Все операции сопровождаются обработкой ошибок и выводом отладочной информации в консоль для проверки корректности работы методов.
